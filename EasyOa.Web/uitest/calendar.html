<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title></title>
    <link href="calendar.css" rel="stylesheet" />
    <script src="../Scripts/jquery-1.7.1.min.js"></script>
    <script src="Calendar.js" type="text/javascript"></script>
    <script>
        var week = ["日", "一", "二", "三", "四", "五", "六"];
        var date = new Date();
        var curr_time_arr = [date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds()];

        $(function () {
            var con_data = $(".calendar_maindata_containter");
            var con_year = $(".calendar_mainyear_containter");
            var con_month = $(".calendar_mainmonth_containter");
            $("#title_year").click(function () {   //点击年
                con_year.stop(); con_month.stop();
                con_year.css({ "z-index": parseInt(con_month.css("z-index"), 10) + 1 });   //让year层在month层上面
                if (con_year.attr("flag") == "0") {   //flag=0;表示年div未显示
                    con_year.animate({ bottom: 0 }, 500, function () {
                        con_month.css({ bottom: con_data.css("height") });
                        con_year.attr("flag", "1");
                        con_month.attr("flag", "0");
                    });
                } else {
                    con_year.animate({ bottom: con_data.css("height") }, 500);
                    con_year.attr("flag", "0");
                }
            })
            $("#title_month").click(function () {  //点击月
                con_year.stop(); con_month.stop();
                con_month.css({ "z-index": parseInt(con_year.css("z-index"), 10) + 1 });  //让moth层在year层上面
                if (con_month.attr("flag") == "0") {   //flag=0;表示月div未显示
                    con_month.animate({ bottom: 0 }, 500, function () {
                        con_year.css({ bottom: con_data.css("height") });
                        con_month.attr("flag", "1");
                        con_year.attr("flag", "0");
                    });
                } else {
                    con_month.animate({ bottom: con_data.css("height") }, 500);
                    con_month.attr("flag", "0");
                }
            });
            $("#last_year").click(function () {  //上一年
                --curr_time_arr[0];
                $("#title_year").text(curr_time_arr[0] + "年");
                changeMainData("left");  //动画改变日期面板
            });
            $("#next_year").click(function () {  //下一年
                ++curr_time_arr[0];
                $("#title_year").text(curr_time_arr[0] + "年");
                changeMainData("right");  //动画改变日期面板
            });
            $("#last_month").click(function () {  //上一月
                --curr_time_arr[1];
                if (curr_time_arr[1] < 0) {
                    curr_time_arr[0]--;
                    curr_time_arr[1] = 11;
                    $("#title_year").text(curr_time_arr[0] + "年");
                }
                $("#title_month").text(monthFormat(parseInt(curr_time_arr[1], 10) + 1, 2) + "月");
                changeMainData("left");//动画改变日期面板
            })
            $("#next_month").click(function () {  //下一月
                ++curr_time_arr[1];
                if (curr_time_arr[1] > 11) {
                    curr_time_arr[0]++;
                    curr_time_arr[1] = 0;
                    $("#title_year").text(curr_time_arr[0] + "年");
                }
                $("#title_month").text(monthFormat(parseInt(curr_time_arr[1], 10) + 1, 2) + "月");
                changeMainData("right");
            })
            $(".calendar_maindata_containter").click(function (e) {
                if (e.target.nodeName.toLowerCase() == "div" && $(e.target).attr("class") != "calendar_data_containter") {
                    var day = $(e.target).text()
                    curr_time_arr[2] = day;
                    var date = dateFormat(curr_time_arr);
                    $("#txt1").val(date);
                }
            })
            $(".week_container").click(function(){return false})
        })
        function changeMainData(direction) {   //以动画效果改变主日期面板,direction=动画方向
            var calendar_width = $(".calendar").css("width");  //主日期框宽度(数据面板的偏移量)
            var dataDiv = createDataDiv(curr_time_arr); //创建
            var dur = 300;
            if (direction == "left") {
                var dataEle = $(dataDiv).css({ left: calendar_width }).attr("flag", "0");  //创建日期数据主面板element
                $(".calendar_maindata_containter").append(dataEle);  //吧日期主面板加入父容器,这时连同以前一个数据面板，一共有2个数据面板
                var containter = $(".calendar_data_containter");   //获取这2个数据面板 
                //2个面板一同移动
                setTimeout(function () {
                    containter.filter(":[flag=1]").animate({ left: "-" + calendar_width }, dur, function () {
                        $(this).remove();
                    });
                }, 0);
                setTimeout(function () {
                    containter.filter(":[flag=0]").animate({ left: 0 }, dur).attr("flag", "1");
                }, 0);
            }
            if (direction == "right") {
                var dataEle = $(dataDiv).css({ left: "-" + calendar_width }).attr("flag", "0");
                $(".calendar_maindata_containter").append(dataEle);
                var containter = $(".calendar_data_containter");
                setTimeout(function () {
                    containter.filter(":[flag=1]").animate({ left: calendar_width }, dur, function () {
                        $(this).remove();
                    });
                }, 0);
                setTimeout(function () {
                    containter.filter(":[flag=0]").animate({ left: 0 }, dur).attr("flag", "1");
                }, 0);
            }
        }
        function getMonthDays(year, month) {  //根据年月获取该月的天数,第一天周几
            var days = new Date(year, month + 1, 0).getDate();  //当前月的天数
            var first_day_week = new Date(year, month, 1).getDay();   //第一天周几
            return { days: days, first_day_week: first_day_week };
        }
        function needAddHeight(curr_time_arr) {  //是否需要增加日期框高度
            var days_week_obj = getMonthDays(curr_time_arr[0], curr_time_arr[1]);  //对象包含当月的天数，第一天周几？
            if (days_week_obj.days == 30 && days_week_obj.first_day_week == 6) return true;
            if (days_week_obj.days == 31 && (days_week_obj.first_day_week == 5 || days_week_obj.first_day_week == 6)) return true;
            return false;
        }
        //alert(Date.prototype.toString());
        function createCalendar(curr_time_arr) {
            var calendar_div = "";
            if (needAddHeight(curr_time_arr)) {
                calendar_div += "<div id=\"calendar\" class=\"calendar cal_len1\">";
            } else {
                calendar_div += "<div id=\"calendar\" class=\"calendar\">";
            }
            calendar_div += "<div id=\"calendar_title_containter\" class=\"calendar_title_containter\">";
            calendar_div += "<div class=\"last_y\"><span id=\"last_y\"></span></div><div class=\"last_m\"><span id=\"last_m\"></span></div><div class=\"title_y\"><span id=\"title_y\">" + curr_time_arr[0] + "年</span></div><div class=\"title_m\"><span id=\"title_m\">" + (curr_time_arr[1] + 1) + "月</span></div><div class=\"next_m\"><span id=\"next_m\"></span></div><div class=\"next_y\"><span id=\"next_y\"></span></div></div>";  //title
            //容器部分
            if (needAddHeight(curr_time_arr)) {
                calendar_div += "<div id=\"calendar_maindata_containter\" class=\"calendar_maindata_containter main_date_len1\">";
            }
            else {
                calendar_div += "<div id=\"calendar_maindata_containter\" class=\"calendar_maindata_containter\">";
            }
            calendar_div += "<div id=\"week_container\" class=\"week_container\"><div id=\"calendar_week\" class=\"calendar_week\">";
            for (var item in week) {
                calendar_div += "<div>" + week[item] + "</div>";
            }
            calendar_div += "</div></div>";
            calendar_div += createDataDiv(curr_time_arr);   //天数
            //$("#d1").html(calendar_div);
            return calendar_div;
        }
        //根据一个月天数，和第一天周几来创建天数据
        function createDataDiv(curr_time_arr) {
            var days_week_obj = getMonthDays(curr_time_arr[0], curr_time_arr[1]);  //对象包含当月的天数，第一天周几？
            var calendar_div = "<div class=\"calendar_data_containter\">";
            for (var i = 0; i < days_week_obj.first_day_week; i++) {   //前面部分
                calendar_div += "<span></span>";
            }
            for (var i = 1; i <= days_week_obj.days; i++) {      // 日期部分
                if (isToday(curr_time_arr, i)) {
                    calendar_div += "<div class=\"today\">" + i + "</div>";
                } else {
                    calendar_div += "<div>" + i + "</div>";
                }
            }
            calendar_div += "</div></div>";
            return calendar_div;
        }
        //判断给定的日期是否今天
        function isToday(curr_time_arr, day) {
            var date = new Date();
            if (date.getFullYear() == curr_time_arr[0] && date.getMonth() == curr_time_arr[1] && date.getDate() == day) return true;
            return false;
        }
        $(function () {
            createCalendar(curr_time_arr);
        })
    </script>
    <style>
        
    </style>
</head>
<body>
    <div id="d1" style="position: absolute; right: 50px; top: 0px; border: 1px solid red; width: 400px; height: 700px">
    </div>
    <input type="text" id="txt1" />


    <div id="calendar" class="calendar cal_len1">
        <div id="calendar_title_containter" class="calendar_title_containter">
            <div class="last_year"><span id="last_year"></span></div>
            <div class="last_month"><span id="last_month"></span></div>
            <div class="title_year"><span id="title_year">2015年</span></div>
            <div class="title_month"><span id="title_month">01月</span></div>
            <div class="next_month"><span id="next_month"></span></div>
            <div class="next_year"><span id="next_year"></span></div>
        </div>
        <div id="calendar_maindata_containter" class="calendar_maindata_containter main_date_len1">
            <div id="week_container" class="week_container">
                <div id="calendar_week" class="calendar_week">
                    <div>日</div>
                    <div>一</div>
                    <div>二</div>
                    <div>三</div>
                    <div>四</div>
                    <div>五</div>
                    <div>六</div>
                </div>
            </div>
            <div class="calendar_data_containter" flag="1">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <div>1</div>
                <div>2</div>
                <div>3</div>
                <div>4</div>
                <div class="today">5</div>
                <div>6</div>
                <div>7</div>
                <div>8</div>
                <div>9</div>
                <div>10</div>
                <div>11</div>
                <div>12</div>
                <div>13</div>
                <div>14</div>
                <div>15</div>
                <div>16</div>
                <div>17</div>
                <div>18</div>
                <div>19</div>
                <div>20</div>
                <div>21</div>
                <div>22</div>
                <div>23</div>
                <div>24</div>
                <div>25</div>
                <div>26</div>
                <div>27</div>
                <div>28</div>
            </div>
        </div>
        <div id="calendar_mainyear_containter" class="calendar_mainyear_containter" flag="0">
            <div>2000</div>
            <div>2001</div>
            <div>2002</div>
            <div>2003</div>
            <div>2004</div>
            <div>2005</div>
            <div>2006</div>
            <div>2007</div>
            <div>2008</div>
            <div>2009</div>
            <div>2010</div>
            <div>2011</div>
            <div>2012</div>
            <div>2013</div>
            <div>2014</div>
            <div>2015</div>
        </div>
        <div id="calendar_mainmonth_containter" class="calendar_mainmonth_containter" flag="0">
            <div>一月</div>
            <div>二月</div>
            <div>三月</div>
            <div>四月</div>
            <div>五月</div>
            <div>六月</div>
            <div>七月</div>
            <div>八月</div>
            <div>九月</div>
            <div>十月</div>
            <div>十一月</div>
            <div>十二月</div>
        </div>
    </div>

</body>
</html>
<script>
 
</script>
